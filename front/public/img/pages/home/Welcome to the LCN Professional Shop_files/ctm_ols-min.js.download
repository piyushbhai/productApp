const ctm_tracker_name="CTM_Tracker";getCtmFor=function(t){return t=t.name!==ctm_tracker_name?window._ctm:t};class CTM_Base{constructor(){this.name=ctm_tracker_name,this.mutationObserver=null,this.type_timer=null,this.logger=!1}simple_log(t,e=null){this.logger&&(e?console.log(t,e):console.log(t))}initialize=function(){this.detect_dom_changes(),document.addEventListener("click",function(t){window._ctm.cart_change_event(t)},!0),this.scan_dom(),this.track_cart_status(),this.track_product_view(),this.check_order_completion(),this.is_home_page(),this.simple_log("initalized")};scan_dom(){var t=getCtmFor(this);t.check_email_form_field(),t.simple_log("dom scanned")}is_home_page=function(){var t=getCtmFor(this),e=(console.log("_ctm page check"),window.location.pathname);"/"!==e&&""!==e||t.transmit_recs_event("home-page-view",[""])};prop_value=function(t){return t.content||t.textContent||t.src};currency_text_to_float=function(t){if(!t)return 0;var e=(t=isNaN(t.charAt(0))?t.substring(1):t).charAt(t.length-3);let r=/,/g,n=!1;return","===e?(r=/\./g,n=!0):!isNaN(e)&&0<t.indexOf(".")&&(r=/\./g),t=t.replace(r,""),n&&(t=t.replace(/,([^,]*)$/,".$1")),parseFloat(t)};validate_email=function(t){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(t).toLowerCase())};get_cart_value_from_price_and_quantity=function(t,e){return parseFloat(t)*parseInt(e)};validate_product=function(t){return t&&t.sku&&t.name&&t.price};transmit_id=function(t){var e,r;t&&(e=getCtmFor(this),(r=window._paq||[]).push(["setUserId",t]),r.push(["trackPageView"]),e.simple_log("transmit email"))};register_product_view=function(t){var e,r;t&&(e=getCtmFor(this),(r=window._paq||[]).push(["setEcommerceView",t.sku,t.name,t.category,t.price]),r.push(["trackEvent","Products","DETAILS_VIEW",t.name]),e.transmit_recs_event("detail-page-view",[t]),e.simple_log("product view registered"))};detect_dom_changes=function(){var t=getCtmFor(this),e=window.MutationObserver||window.WebKitMutationObserver;e?(t.mutationObserver=new e(window._ctm.scan_dom),t.mutationObserver.observe(document.body,{childList:!0,subtree:!0})):window.addEventListener&&(document.addEventListener("DOMNodeInserted",window._ctm.scan_dom,!1),document.addEventListener("DOMNodeRemoved",window._ctm.scan_dom,!1))};check_email_form_field=function(){var t=getCtmFor(this),e=document.querySelectorAll("input[type=email]"),r=t.get_email_text_inputs();if(e&&e.length)for(var n=0,i=e.length;n<i;n++)t.watch_input(e[n]);if(r&&r.length)for(n=0,i=r.length;n<i;n++)t.watch_input(r[n]);t.simple_log("checked email form fields")};watch_input=function(t){var e="input";t.removeEventListener(e,function(){var t=this.value;window._ctm.set_id_from_field(t)},!0),t.addEventListener(e,function(){var t=this.value;window._ctm.set_id_from_field(t)},!0)};set_id_from_field=function(t){let e=getCtmFor(this);e.validate_email(t)&&(e.type_timer&&clearTimeout(e.type_timer),e.type_timer=setTimeout(function(){e.transmit_id(t)},1e3))};track_cart_status=function(){var t=getCtmFor(this),e=window._paq||[],r=t.get_cart_total();0<r&&(e.push(["trackEcommerceCartUpdate",r]),t.simple_log("cart status updated at "+r))};cart_change_event=function(t){let o=getCtmFor(this),a=window._paq||[];var t=t.target;o.detect_add_to_cart(t)?(o.simple_log("is_add_to_cart",!0),o.get_cart_items(t).then(r=>{if(r.length){for(let t=0,e=r.length;t<e;t++){a.push(["trackEvent","Sales","ADD_TO_CART",r[t].name]),o.transmit_recs_event("add-to-cart",r);var n=r[t].variants;if(n)for(const i in n)Object.hasOwn(n,i)&&o.validate_product(n[i])&&o.store_product_by_variant_id(i,n[i])}o.simple_log("ADD_TO_CART",r[0].name)}})):(o.simple_log("is_add_to_cart",!1),o.detect_remove_from_cart(t)&&(t=o.get_removed_item(t))&&(a.push(["trackEvent","Sales","REMOVE_FROM_CART",t]),o.simple_log("REMOVE_FROM_CART")))};track_product_view=function(t){var e=getCtmFor(this);let r=e.get_product_by_platform(),n=e.validate_product(r);if(!n){var i=[e.get_product_from_json,e.get_product_from_meta];for(let t=0;t<i.length;t++){var o=i[t]();if(o){r=r||{};for(var a of Object.keys(o))o[a]&&!r[a]&&(r[a]=o[a]);if(n=e.validate_product(r))break}}}return e.simple_log("product found ",r),r||(r=e.find_product_from_target_json(t),e.simple_log("target product found ",r),r&&(n=e.validate_product(r))),n?(e.register_product_view(r),r):null};find_product_from_target_json=function(t){if(!t)return null;var e=getCtmFor(this),r=t.querySelectorAll('[type="application/json"]');let n=null;if(r.length)for(let t=0;t<r.length;t++){var i=JSON.parse(r[t].innerHTML);i&&i.id&&i.title&&i.price&&i.variants&&(n={sku:i.variants[0].sku,name:i.name,category:[],price:i.price/100})}else{t=t.parentElement;"BODY"!=t.nodeName&&(n=e.find_product_from_target_json(t))}return n};get_product_from_json=function(){var e=document.querySelectorAll('[type="application/ld+json"]');if(e&&e.length)for(let t=0;t<e.length;t++){var r,n=JSON.parse(e[t].innerHTML);if(n&&"Product"==n["@type"])return r={sku:n.sku,name:n.name,category:[],price:0},n.category&&r.category.push(n.category),n.offers&&n.offers.price&&(r.price=parseFloat(n.offers.price)),r}return null};get_product_from_meta=function(){const n=[];let i=getCtmFor(this);if(document.querySelectorAll("[itemscope]").forEach(function(t,e){const r={type:[t.getAttribute("itemtype")],properties:{}};t.querySelectorAll("[itemprop]").forEach(function(t){if(r.properties[t.getAttribute("itemprop")]=i.prop_value(t),t.matches("[itemscope]")&&t.matches("[itemprop]")){const e={type:[t.getAttribute("itemtype")],properties:{}};t.querySelectorAll("[itemprop]").forEach(function(t){e.properties[t.getAttribute("itemprop")]=i.prop_value(t)}),r.properties[t.getAttribute("itemprop")]=[e]}}),n.push(r)}),n.length)for(let t=0;t<n.length;t++){var e=n[t].type[0],r=n[t].properties;if(!(["https://schema.org/Product","http://schema.org/Product"].indexOf(e)<0)){let t=[];return r.category&&(t=[r.category]),{sku:r.sku,name:r.name,category:t,price:i.currency_text_to_float(r.price)}}}return null};check_order_completion=function(){var t=getCtmFor(this),e=t.is_completed_order();if(e&&e.order_id){var r=window._paq||[],n=t.get_order_products();if(n&&n.length){for(let t=0;t<n.length;t++)r.push(["addEcommerceItem",n[t].sku,n[t].name,[n[t].category],n[t].price,n[t].quantity]);t.transmit_recs_event("purchase-complete",n)}r.push(["trackEcommerceOrder",e.order_id,e.grand_total,e.sub_total,e.tax,e.shipping,!1]),t.simple_log("completed order")}};transmit_recs_event=function(t,e){if(window._ctm_recs_project_id&&window._ctm_recs_api_key){const r={eventType:t,visitorId:"",userInfo:{userId:""},attributionToken:"",productDetails:[]};if(e&&e.length)for(let t=0;t<e.length;t++)e[t]&&e[t].sku&&r.productDetails.push({product:{id:e[t].sku}});console.log("recs engine"),_paq.push([function(){window._ctm_visitor_id=this.getVisitorId(),window._ctm.recs_push(r),window._ctm.recs_get_product_ids(r)}])}else console.log('no "_ctm_recs_project_id" or no "_ctm_recs_api_key"',window._ctm_recs_project_id,window._ctm_recs_api_key)};recs_push=function(t){var e;console.log("_ctm push"),window._ctm_visitor_id&&(t.visitorId=window._ctm_visitor_id,console.log("_ctm recs",window._ctm_visitor_id),window._gre=window._gre||[],window._gre.push(["apiKey",window._ctm_recs_api_key]),window._gre.push(["projectId",window._ctm_recs_project_id]),window._gre.push(["locationId","global"]),window._gre.push(["catalogId","default_catalog"]),window._gre.push(["logEvent",t]),window._ctm_recs_project_id&&0<=window._ctm_recs_project_id.indexOf("test")?console.log("_ctm recs test",window._gre):((t=document.createElement("script")).type="text/javascript",t.async=!0,t.src="https://www.gstatic.com/retail/v2_event.js",(e=document.getElementsByTagName("script")[0]).parentNode.insertBefore(t,e)))};recs_get_product_ids=function(e){console.log("_ctm recs fetch"),window._ctm_visitor_id&&(async()=>{var t=await fetch("https://provisioning.analytics-public.cart.com/recs_ai/get_product_ids",{method:"POST",body:JSON.stringify({visitor_id:window._ctm_visitor_id,event_type:e.eventType,product_details:e.productDetails}),headers:{"Content-Type":"application/json"}});window.console.log(await t.json())})()}}class CTM_Tracker extends CTM_Base{constructor(){super(),this.simple_log("online-store platform loaded")}store_product_by_variant_id=function(){return null};fetch_product_by_variant_id=function(){return null};get_email_text_inputs=function(){return document.getElementsByClassName("validate-email")};get_cart_total=function(){var r=this,t=("CTM_Tracker"!==r.name&&(r=window._ctm),document.getElementsByClassName("smallCart-wrapper")),n=[],e=0;if(t.length){t[0];var i,t=document.getElementsByClassName("SmallShoppingCart");(t=1==t.length?t[0]:null)&&(i=t.id.replace("_dvControl",""));for(var o=0;o<100;){var a=i+"_rpCart_ctl"+("0"+o).slice(-2),c=a+"_Quantity",a=document.getElementById(a+"_lblPrice"),c=document.getElementById(c);if(o++,!a)break;{let t=a.innerText,e="1";t=t.replace("$",""),c&&(e=c.value),n.push(r.get_cart_value_from_price_and_quantity(t,e))}}if(n.length)for(var _=0,o=n.length;_<o;_++)e+=n[_]}return e};detect_add_to_cart=function(t){var e=!1;return t.href&&0<=t.href.indexOf("AddToCart")||"btnAddToCart"===t.id?e=!0:t.classList.contains("spinnerBtn")&&(e=(t=t.getElementsByClassName("fa-plus"))&&t.length),e};detect_remove_from_cart=function(t){var e,r=!1;return t.classList.contains("clear-item-link")?r=!0:t.classList.contains("spinnerBtn")?r=(e=t.getElementsByClassName("fa-minus"))&&e.length:t.closest(".clear-item-link")&&(r=!0),r};get_cart_items=async function(E){return new Promise(function(t,e){var r=void 0!==this?this:window._ctm,n=(r.hasOwnProperty("name")&&"CTM_Tracker"===r.name||(r=window._ctm),[]);if(E.href&&E.href.indexOf("AddToCart")){var i=E.href.split("?")[1].split("&"),o={};if(i&&i.length){for(var a=0,c=i.length;a<c;a++){var _=i[a].split("=");"ItemID"===_[0]?o.item_id=_[1]:"Quantity"===_[0]&&(o.quantity=_[1])}var s=E.parentElement.parentElement,l=s.getElementsByTagName("input"),d=s.getElementsByTagName("div");if(l.length)for(var m=0,u=l.length;m<u;m++)if(0<=l[m].id.indexOf("hidPrice")){o.price=r.currency_text_to_float(l[m].value);break}if(d.length)for(var p=0,g=d.length;p<g;p++)if(d[p].getAttribute("data-id")==o.item_id){o.name=d[p].getAttribute("data-name");break}o.price&&o.name||(s=E.closest(".category-product"))&&(o.name||(f=s.querySelectorAll("[data-title]"))&&(o.name=f[0].getAttribute("data-title")),o.price||(f=s.getElementsByClassName("CategoryProductPrice"))&&f.length&&(o.price=r.currency_text_to_float(f[0].innerText)))}n.push(o)}else if("btnAddToCart"===E.id){var o={},s=document.getElementById("lblPrice"),f=document.getElementsByClassName("ProductDetailsProductName");s&&(o.price=r.currency_text_to_float(s.innerText)),f&&f.length&&(o.name=f[0].innerText);var h,v,w,y,C={};for(h of new FormData(E.form).entries())"hfItemID"===h[0]?o.item_id=h[1]:"txtQuantity"===h[0]?o.quantity=h[1]:0===h[0].indexOf("acctl")&&5<=(v=h[0].split("$")).length&&(C[w=v[0]+"_"+v[2]]||(C[w]={}),C[w][v[3]]||(C[w][v[3]]={}),C[w][v[3]].unit_class=v[0]+"_"+v[1]+"_"+v[2]+"_"+v[3],C[w][v[3]][v[4]]=h[1]);if(n.push(o),Object.keys(C).length)for(var k in C)for(var T in C[k])C[k][T].chkAddToCart&&(y={item_id:C[k][T].hidItemID,price:C[k][T].hidPrice,quantity:C[k][T].txtQtyForCart},T=C[k][T].unit_class+"_dvControlItem",T=document.getElementById(T))&&(T=T.getElementsByClassName("prod-also-name"))&&T.length&&(y.name=T[0].innerText,n.push(y))}t(n)})};get_removed_item=function(t){var e=t.closest(".smallCart-item"),r="";return r=(e=e||t.closest(".SmallCartItem"))&&(t=e.getElementsByClassName("SmallCartItemLink"))&&t.length?t[0].innerText:r};is_completed_order=function(){var t=this;"CTM_Tracker"!==t.name&&(t=window._ctm);var e,r,n,i,o,a=null;return document.body.classList.contains("ViewOrder")&&(e=document.getElementById("lblOrderID"),r=document.getElementById("lblTotal"),n=document.getElementById("lblSubTotal"),i=document.getElementById("lblTax"),o=document.getElementById("lblShipping"),e)&&((a={}).order_id=e.innerText,a.grand_total=r&&t.currency_text_to_float(r.innerText)||0,a.sub_total=n&&t.currency_text_to_float(n.innerText)||0,a.tax=i&&t.currency_text_to_float(i.innerText)||0,a.shipping=o&&t.currency_text_to_float(o.innerText)||0),a};get_order_products=function(){var t=null,e=window.prodArray;if(e)for(var t=[],r=0,n=e.length;r<n;r++){var i={sku:e[r].id,name:e[r].name,category:e[r].category,price:e[r].price,quantity:e[r].quantity};t.push(i)}return t};get_product_by_platform=function(){var e,t=this,r=("CTM_Tracker"!==t.name&&(t=window._ctm),document.getElementById("btnAddToCart"));return r&&(e=null,t.get_cart_items(r).then(t=>{t&&1===t.length&&(e=t[0])}),null!==e)&&e.hasOwnProperty("item_id")?(e.sku=e.item_id,e):null}}function _ctm_load_tag_manager(){window._ctm=new CTM_Tracker,window._ctm.initialize()}"loading"!==document.readyState?_ctm_load_tag_manager():document.addEventListener("DOMContentLoaded",function(){_ctm_load_tag_manager()});